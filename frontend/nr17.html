<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>DataInsight SST ‚Äì NR-17 / Avalia√ß√£o Ergon√¥mica</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="assets/branding.css">

  <!-- Biblioteca para gerar PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <!-- Estilos extras espec√≠ficos da tela NR-17 -->
  <style>
    /* layout geral da p√°gina */
    .nr17-page {
      max-width: 1400px;
      margin: 0 auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* card superior (t√≠tulo + √≠ndice + bot√µes) */
    .nr17-header-card {
      padding: 16px 20px;
    }

    .nr17-header-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 12px;
    }

    .nr17-title-block h2 {
      margin: 0;
      font-size: 20px;
    }

    .nr17-title-block p {
      margin: 4px 0 0;
      color: #6b7280;
      font-size: 13px;
    }

    .nr17-actions {
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 220px;
    }

    .nr17-index-row {
      margin-top: 8px;
      font-size: 14px;
      color: #374151;
    }

    /* grid principal: coluna esquerda (cards) + coluna direita (futuro resumo/gr√°fico) */
    .nr17-main-grid {
      display: grid;
      grid-template-columns: minmax(0, 380px) minmax(0, 1fr);
      gap: 16px;
      align-items: flex-start;
    }

    .nr17-left-col {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .nr17-right-col {
      min-height: 100px;
    }

    /* formul√°rio da esquerda */
    .nr17-form-card h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 16px;
    }

    .nr17-form-card p.section-subtitle {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 12px;
      color: #6b7280;
    }

    .nr17-form-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 8px;
    }

    .nr17-form-grid label {
      font-size: 12px;
      color: #374151;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .nr17-form-grid input,
    .nr17-form-grid select,
    .nr17-form-grid textarea {
      font-size: 13px;
    }

    @media (min-width: 900px) {
      .nr17-form-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .nr17-form-grid label.full-row {
        grid-column: 1 / -1;
      }
    }

    /* tabela de avalia√ß√µes */
    .nr17-table-card h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 15px;
    }

    .nr17-filter-row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }

    .nr17-filter-row input {
      flex: 1;
      max-width: 320px;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    .table thead {
      background: #f3f4f6;
    }

    .table th,
    .table td {
      padding: 6px 8px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      white-space: nowrap;
    }

    .table th:last-child,
    .table td:last-child {
      text-align: center;
    }

    .nr17-table-wrapper {
      max-height: 220px;
      overflow: auto;
    }

    /* bot√µes de a√ß√£o da tabela (‚úèÔ∏è / üóëÔ∏è) */
    .actions-cell {
      display: flex;
      gap: 4px;
      justify-content: center;
    }

    .icon-btn {
      border: none;
      background: #e5f0ff;
      border-radius: 6px;
      padding: 2px 6px;
      cursor: pointer;
      font-size: 12px;
      line-height: 1;
      transition: background 0.15s, transform 0.05s;
    }

    .icon-btn:hover {
      background: #d0e3ff;
      transform: translateY(-1px);
    }

    .icon-btn.delete {
      background: #ffe4e1;
    }

    .icon-btn.delete:hover {
      background: #ffc9c4;
    }

    /* responsivo */
    @media (max-width: 900px) {
      .nr17-main-grid {
        grid-template-columns: minmax(0, 1fr);
      }

      .nr17-actions {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: flex-end;
      }
    }
  </style>

  <script src="nr17.js" defer></script>
</head>

<body>

<nav class="nav">
  <div class="wrap">
    <div class="logo">
      <img src="assets/datainsight.jpg" alt="Logo DataInsight SST">
      <span>DataInsight SST Suite</span>
    </div>

    <div style="margin-left:auto; display:flex; gap:8px;">
      <a class="btn secondary" href="dashboard.html">üè† Dashboard</a>
      <a class="btn secondary" href="pgr.html">üìù PGR / NR-01</a>
      <a class="btn secondary" href="pcmso.html">‚öïÔ∏è PCMSO / ASO</a>
      <a class="btn active" href="nr17.html">ü™ë NR-17</a>
      <a class="btn secondary" href="ltcat.html">üìÑ LTCAT</a>
      <button onclick="logout()" class="btn danger">Sair</button>
    </div>
  </div>
</nav>

<main>
  <div class="nr17-page">

    <!-- CARD SUPERIOR: t√≠tulo + √≠ndice + bot√µes -->
    <section class="card nr17-header-card">
      <div class="nr17-header-top">
        <div class="nr17-title-block">
          <h2>NR-17 ‚Äî Avalia√ß√£o Ergon√¥mica de Posto de Trabalho</h2>
          <p>Registre as condi√ß√µes ergon√¥micas do posto e obtenha uma classifica√ß√£o simples de risco.</p>
        </div>

        <div class="nr17-actions">
          <button id="btn-salvar-nr17" class="btn primary" onclick="salvarNR17()">üíæ Salvar Avalia√ß√£o</button>
          <button class="btn secondary" onclick="limparNR17()">üßπ Limpar</button>
          <button class="btn secondary" onclick="imprimirUltimaNR17()">üñ®Ô∏è Imprimir √∫ltima avalia√ß√£o</button>
          <button class="btn secondary" onclick="exportarPDFUltimaNR17()">üìÑ Exportar PDF (√∫ltima)</button>
        </div>
      </div>

      <div class="nr17-index-row">
        √çndice global de risco:
        <strong id="resultadoRisco">‚Äì</strong>
      </div>
    </section>

    <!-- GRID PRINCIPAL -->
    <section class="nr17-main-grid">

      <!-- COLUNA ESQUERDA -->
      <div class="nr17-left-col">

        <!-- FORMUL√ÅRIO -->
        <section class="card nr17-form-card">
          <h3>Dados da Avalia√ß√£o de Posto de Trabalho</h3>
          <p class="section-subtitle">
            Preencha as informa√ß√µes b√°sicas do posto e os fatores ergon√¥micos que comp√µem o √≠ndice NR-17.
          </p>

          <div class="nr17-form-grid">

            <label>Empresa (opcional)
              <input type="text" id="empresa" placeholder="Ex: Metal√∫rgica Alfa LTDA">
            </label>

            <label>Setor
              <input type="text" id="setor" placeholder="Ex: Administrativo / Produ√ß√£o">
            </label>

            <label>Fun√ß√£o Avaliada
              <input type="text" id="funcao" placeholder="Ex: Operador de M√°quina / Digitador">
            </label>

            <label>Trabalhador (opcional)
              <input type="text" id="trabalhador" placeholder="Nome ou c√≥digo">
            </label>

            <label>Tipo de Posto
              <select id="tipoPosto">
                <option value="Administrativo">Administrativo</option>
                <option value="Produ√ß√£o">Produ√ß√£o</option>
                <option value="Atendimento">Atendimento</option>
                <option value="Outro">Outro</option>
              </select>
            </label>

            <label>Data da Avalia√ß√£o
              <input type="date" id="dataAvaliacao">
            </label>

            <label>Mobili√°rio / Ajustes
              <select id="mobiliario" onchange="calcularIndiceNR17()">
                <option value="1">Adequado (ajustes suficientes)</option>
                <option value="2">Parcialmente adequado</option>
                <option value="3">Inadequado / sem ajustes</option>
              </select>
            </label>

            <label>Posturas de Trabalho
              <select id="postura" onchange="calcularIndiceNR17()">
                <option value="1">Confort√°vel / poucas queixas</option>
                <option value="2">Algum desconforto / posturas mantidas</option>
                <option value="3">Posturas for√ßadas / queixas frequentes</option>
              </select>
            </label>

            <label>Esfor√ßo F√≠sico / Carga
              <select id="esforco" onchange="calcularIndiceNR17()">
                <option value="1">Esfor√ßo leve</option>
                <option value="2">Esfor√ßo moderado</option>
                <option value="3">Esfor√ßo intenso / repetitivo</option>
              </select>
            </label>

            <label>Pausas / Ritmo de Trabalho
              <select id="pausas" onchange="calcularIndiceNR17()">
                <option value="1">Pausas adequadas</option>
                <option value="2">Pausas insuficientes</option>
                <option value="3">Sem pausas / ritmo elevado</option>
              </select>
            </label>

            <label>Ambiente F√≠sico (ilumina√ß√£o, ru√≠do, temperatura)
              <select id="ambiente" onchange="calcularIndiceNR17()">
                <option value="1">Condi√ß√µes adequadas</option>
                <option value="2">Alguns inc√¥modos</option>
                <option value="3">Condi√ß√µes desfavor√°veis</option>
              </select>
            </label>

            <label>Organiza√ß√£o do Trabalho / Exig√™ncias cognitivas
              <select id="organizacao" onchange="calcularIndiceNR17()">
                <option value="1">Organizado, demandas claras</option>
                <option value="2">Alguma press√£o / demandas pouco claras</option>
                <option value="3">Alta press√£o / demandas conflitantes</option>
              </select>
            </label>

            <label class="full-row">Observa√ß√µes (opcional)
              <textarea id="observacoes" rows="3" placeholder="Descreva situa√ß√µes cr√≠ticas, queixas, sugest√µes de melhoria..."></textarea>
            </label>

          </div>
        </section>

        <!-- TABELA DE AVALIA√á√ïES -->
        <section class="card nr17-table-card">
          <h3>üìã Avalia√ß√µes Registradas ‚Äî NR-17</h3>

          <div class="nr17-filter-row">
            <input
              type="text"
              id="filtroNR17"
              placeholder="Filtrar por setor, fun√ß√£o ou risco..."
              oninput="filtrarNR17()"
            >
          </div>

          <div class="nr17-table-wrapper">
            <table class="table" id="tabelaNR17">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Setor</th>
                  <th>Fun√ß√£o</th>
                  <th>Tipo de Posto</th>
                  <th>Classifica√ß√£o de Risco</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>

      </div>

      <!-- COLUNA DIREITA (livre, p/ futuro dashboard NR-17) -->
      <div class="nr17-right-col">
        <!-- aqui depois podemos colocar gr√°ficos, cards-resumo, etc. -->
      </div>

    </section>

    <!-- √ÅREA OCULTA PARA GERAR PDF BONITO -->
    <div id="areaRelatorioNR17" style="display:none;">
      <div id="conteudoRelatorioNR17" style="padding:20px; font-family:system-ui;"></div>
    </div>

  </div>
</main>

<script>
  function logout() {
    localStorage.clear();
    window.location.href = "index.html";
  }
</script>

</body>
</html>
