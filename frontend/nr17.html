<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>DataInsight SST ‚Äì NR-17 / Avalia√ß√£o Ergon√¥mica</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="assets/branding.css">

  <!-- Biblioteca para gerar PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <!-- Estilos espec√≠ficos da tela NR-17 -->
  <style>
    .nr17-grid {
      max-width: 1500px;
      margin: 24px auto;
      display: grid;
      grid-template-columns: 320px minmax(0, 1fr);
      column-gap: 24px;
      align-items: flex-start;
    }

    .nr17-sidebar.card {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .nr17-sidebar h1 {
      font-size: 1.5rem;
      margin-bottom: 4px;
    }

    .nr17-sidebar p {
      margin: 0;
    }

    .nr17-sidebar .risk-indicator {
      margin-top: 8px;
      font-size: 0.95rem;
    }

    .nr17-sidebar .risk-indicator strong {
      font-size: 1.05rem;
    }

    .nr17-sidebar .btn {
      width: 100%;
      justify-content: flex-start;
    }

    .nr17-main {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .nr17-main .form-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 8px;
    }

    @media (min-width: 900px) {
      .nr17-main .form-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .nr17-main .form-grid > label[style*="grid-column: 1 / -1"],
      .nr17-main .form-grid > label.nr17-full {
        grid-column: 1 / -1 !important;
      }
    }

    /* Tabela ocupa largura total do card */
    #tabelaNR17 {
      width: 100%;
      border-collapse: collapse;
    }

    #tabelaNR17 th,
    #tabelaNR17 td {
      padding: 6px 8px;
    }

    /* Layout responsivo: empilha tudo no mobile */
    @media (max-width: 900px) {
      .nr17-grid {
        display: block;
        margin: 16px auto;
      }
      .nr17-sidebar {
        margin-bottom: 16px;
      }
    }
  </style>

  <script src="nr17.js" defer></script>
</head>

<body>

<nav class="nav">
  <div class="wrap">
    <div class="logo">
      <img src="assets/datainsight.jpg" alt="Logo">
      <span>DataInsight SST Suite</span>
    </div>

    <div style="margin-left:auto; display:flex; gap:8px;">
      <a class="btn secondary" href="dashboard.html">üè† Dashboard</a>
      <a class="btn secondary" href="pgr.html">üìù PGR / NR-01</a>
      <a class="btn secondary" href="pcmso.html">‚öïÔ∏è PCMSO / ASO</a>
      <a class="btn active" href="nr17.html">ü™ë NR-17</a>
      <a class="btn secondary" href="ltcat.html">üìÑ LTCAT</a>
      <button onclick="logout()" class="btn danger">Sair</button>
    </div>
  </div>
</nav>

<main class="page">
  <div class="nr17-grid">
        .actions-cell {
      display: flex;
      gap: 4px;
      justify-content: center;
    }

    .icon-btn {
      border: none;
      background: #e9eff7;
      border-radius: 6px;
      padding: 3px 6px;
      cursor: pointer;
      font-size: 12px;
      line-height: 1;
      transition: background 0.15s, transform 0.05s;
    }

    .icon-btn:hover {
      background: #d3e2ff;
      transform: translateY(-1px);
    }

    .icon-btn.delete {
      background: #ffe1e1;
    }

    .icon-btn.delete:hover {
      background: #ffc4c4;
    }


    <!-- COLUNA ESQUERDA: T√çTULO + √çNDICE + A√á√ïES R√ÅPIDAS -->
    <section class="card nr17-sidebar">
      <div>
        <h1>NR-17 ‚Äî Avalia√ß√£o Ergon√¥mica</h1>
        <p>Registre as condi√ß√µes ergon√¥micas do posto e obtenha uma classifica√ß√£o simples de risco.</p>
      </div>

      <div class="risk-indicator">
        √çndice global de risco:
        <strong id="resultadoRisco">‚Äì</strong>
      </div>

      <div style="display:flex; flex-direction:column; gap:8px; margin-top:8px;">
        <button id="btn-salvar-nr17" class="btn primary" onclick="salvarNR17()">üíæ Salvar Avalia√ß√£o</button>
        <button class="btn secondary" onclick="limparNR17()">üßπ Limpar</button>
        <button class="btn secondary" onclick="imprimirUltimaNR17()">üñ®Ô∏è Imprimir √∫ltima avalia√ß√£o</button>
        <button class="btn secondary" onclick="exportarPDFUltimaNR17()">üìÑ Exportar PDF (√∫ltima)</button>
      </div>
    </section>

    <!-- COLUNA DIREITA: FORMUL√ÅRIO + TABELA -->
    <div class="nr17-main">

      <!-- CARD FORMUL√ÅRIO -->
      <section class="card">
        <h2>ü™ë Dados da Avalia√ß√£o de Posto de Trabalho</h2>

        <div class="form-grid mt-3">

          <label>Empresa (opcional)
            <input type="text" id="empresa" placeholder="Ex: Metal√∫rgica Alfa LTDA">
          </label>

          <label>Setor
            <input type="text" id="setor" placeholder="Ex: Administrativo / Produ√ß√£o">
          </label>

          <label>Fun√ß√£o Avaliada
            <input type="text" id="funcao" placeholder="Ex: Operador de M√°quina / Digitador">
          </label>

          <label>Trabalhador (opcional)
            <input type="text" id="trabalhador" placeholder="Nome ou c√≥digo">
          </label>

          <label>Tipo de Posto
            <select id="tipoPosto">
              <option value="Administrativo">Administrativo</option>
              <option value="Produ√ß√£o">Produ√ß√£o</option>
              <option value="Atendimento">Atendimento</option>
              <option value="Outro">Outro</option>
            </select>
          </label>

          <label>Data da Avalia√ß√£o
            <input type="date" id="dataAvaliacao">
          </label>

          <label>Mobili√°rio / Ajustes
            <select id="mobiliario" onchange="calcularIndiceNR17()">
              <option value="1">Adequado (ajustes suficientes)</option>
              <option value="2">Parcialmente adequado</option>
              <option value="3">Inadequado / sem ajustes</option>
            </select>
          </label>

          <label>Posturas de Trabalho
            <select id="postura" onchange="calcularIndiceNR17()">
              <option value="1">Confort√°vel / poucas queixas</option>
              <option value="2">Algum desconforto / posturas mantidas</option>
              <option value="3">Posturas for√ßadas / queixas frequentes</option>
            </select>
          </label>

          <label>Esfor√ßo F√≠sico / Carga
            <select id="esforco" onchange="calcularIndiceNR17()">
              <option value="1">Esfor√ßo leve</option>
              <option value="2">Esfor√ßo moderado</option>
              <option value="3">Esfor√ßo intenso / repetitivo</option>
            </select>
          </label>

          <label>Pausas / Ritmo de Trabalho
            <select id="pausas" onchange="calcularIndiceNR17()">
            <option value="1">Pausas adequadas</option>
              <option value="2">Pausas insuficientes</option>
              <option value="3">Sem pausas / ritmo elevado</option>
            </select>
          </label>

          <label>Ambiente F√≠sico (ilumina√ß√£o, ru√≠do, temperatura)
            <select id="ambiente" onchange="calcularIndiceNR17()">
              <option value="1">Condi√ß√µes adequadas</option>
              <option value="2">Alguns inc√¥modos</option>
              <option value="3">Condi√ß√µes desfavor√°veis</option>
            </select>
          </label>

          <label>Organiza√ß√£o do Trabalho / Exig√™ncias cognitivas
            <select id="organizacao" onchange="calcularIndiceNR17()">
              <option value="1">Organizado, demandas claras</option>
              <option value="2">Alguma press√£o / demandas pouco claras</option>
              <option value="3">Alta press√£o / demandas conflitantes</option>
            </select>
          </label>

          <label class="nr17-full">Observa√ß√µes (opcional)
            <textarea id="observacoes" rows="3" placeholder="Descreva situa√ß√µes cr√≠ticas, queixas, sugest√µes de melhoria..."></textarea>
          </label>

        </div>
      </section>

      <!-- CARD TABELA + FILTRO -->
      <section class="card">
        <h2>üìã Avalia√ß√µes Registradas ‚Äî NR-17</h2>

        <div class="actions-row">
          <input
            type="text"
            id="filtroNR17"
            placeholder="Filtrar por setor, fun√ß√£o ou risco..."
            oninput="filtrarNR17()"
            style="flex:1; max-width:320px;"
          >
        </div>

        <table class="table" id="tabelaNR17">
        <thead>
          <tr>
            <th>Data</th>
            <th>Setor</th>
            <th>Fun√ß√£o</th>
            <th>Tipo de Posto</th>
            <th>Classifica√ß√£o de Risco</th>
            <th style="width:110px; text-align:center;">A√ß√µes</th>
          </tr>
        </thead>
            <tbody></tbody>
        </table>
      </section>

      <!-- √ÅREA OCULTA PARA GERAR PDF BONITINHO -->
      <div id="areaRelatorioNR17" style="display:none;">
        <div id="conteudoRelatorioNR17" style="padding:20px; font-family:system-ui;">
          <!-- O JS preenche isso aqui antes de gerar PDF -->
        </div>
      </div>

    </div>
  </div>
</main>

<script>
function logout() {
  localStorage.clear();
  window.location.href = "index.html";
}
</script>

</body>
</html>
