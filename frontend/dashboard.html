<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>DataInsight SST Suite ‚Äî Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="assets/branding.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="dashboard.js"></script>
</head>

<body>
  <!-- NAVBAR DA SUITE -->
  <nav class="nav">
    <div class="wrap">
      <div class="logo">
        <img src="assets/datainsight.jpg" alt="Logo">
        <span>DataInsight SST Suite</span>
      </div>

      <div style="margin-left:auto; display:flex; gap:8px; flex-wrap:wrap;">
        <a class="btn active" href="dashboard.html">üè† Dashboard</a>
        <a class="btn secondary" href="pgr.html">üìù PGR / NR-01</a>
        <a class="btn secondary" href="pcmsos.html">‚öïÔ∏è PCMSO / ASO</a>
        <a class="btn secondary" href="nr17.html">ü™ë NR-17</a>
        <a class="btn secondary" href="ltcat.html">üìÑ LTCAT</a>
        <button class="btn danger" onclick="logout()">Sair</button>
      </div>
    </div>
  </nav>

  <main class="container" style="padding-top:24px; padding-bottom:32px;">
    <!-- CABE√áALHO -->
    <section class="card">
      <h2 style="margin-top:0;">üìä Vis√£o Geral da Suite</h2>
      <p style="margin-bottom:0;">
        Indicadores consolidados dos m√≥dulos PCMSO / ASO, NR-17 e LTCAT com base nos registros armazenados
        na plataforma (Supabase / API).
      </p>
    </section>

    <!-- KPIs PRINCIPAIS -->
    <section class="kpi-grid">
      <div class="card kpi-card">
        <h3>Total de ASOS registrados</h3>
        <p class="kpi-value" id="kpi-total-asos">‚Äî</p>
        <p class="kpi-subtitle">Exames ocupacionais armazenados.</p>
      </div>

      <div class="card kpi-card">
        <h3>Total de avalia√ß√µes NR-17</h3>
        <p class="kpi-value" id="kpi-total-nr17">‚Äî</p>
        <p class="kpi-subtitle">Avalia√ß√µes ergon√¥micas registradas.</p>
      </div>

      <div class="card kpi-card">
        <h3>Total de registros LTCAT</h3>
        <p class="kpi-value" id="kpi-total-ltcat">‚Äî</p>
        <p class="kpi-subtitle">Agentes nocivos / enquadramentos.</p>
      </div>

      <div class="card kpi-card">
        <h3>Risco m√©dio NR-17</h3>
        <p class="kpi-value" id="kpi-risco-medio-nr17">‚Äî</p>
        <p class="kpi-subtitle">Score m√©dio global das avalia√ß√µes.</p>
      </div>
    </section>

    <!-- TABS DOS DASHBOARDS -->
    <section class="card" style="margin-top:24px;">
      <div class="dashboard-tabs">
        <button class="tab-button active" data-tab="geral">üåê Geral</button>
        <button class="tab-button" data-tab="nr17">ü™ë NR-17</button>
        <button class="tab-button" data-tab="pcmsos">‚öïÔ∏è PCMSO / ASO</button>
        <button class="tab-button" data-tab="pgr">üìù PGR / NR-01</button>
        <button class="tab-button" data-tab="ltcat">üìÑ LTCAT</button>
      </div>
    </section>

    <!-- PAINEL GERAL (COMPLETO) -->
    <section id="tab-geral" class="tab-panel active">
      <div class="grid-2">
        <div class="card">
          <h3 style="margin-top:0;">Distribui√ß√£o de registros por m√≥dulo</h3>
          <canvas id="chart-distribuicao-modulos" height="220"></canvas>
          <p class="chart-caption">
            Quantidade de registros consolidados nos m√≥dulos ASO, NR-17 e LTCAT.
          </p>
        </div>

        <div class="card">
          <h3 style="margin-top:0;">Perfil de risco ‚Äî NR-17</h3>
          <canvas id="chart-perfil-risco-nr17" height="220"></canvas>
          <p class="chart-caption">
            Quantidade de avalia√ß√µes classificadas como Baixo, M√©dio e Alto risco.
          </p>
        </div>
      </div>

      <div class="grid-2" style="margin-top:16px;">
        <div class="card">
          <h3 style="margin-top:0;">Agentes nocivos mais registrados ‚Äî LTCAT</h3>
          <canvas id="chart-agentes-top" height="220"></canvas>
          <p class="chart-caption">
            Top 5 agentes com maior n√∫mero de ocorr√™ncias nos registros LTCAT.
          </p>
        </div>

        <div class="card">
          <h3 style="margin-top:0;">√öltimas atividades</h3>
          <div id="lista-ultimas-atividades" class="activity-list">
            <p>Carregando...</p>
          </div>
        </div>
      </div>
    </section>

    <!-- PAINEL NR-17 -->
    <section id="tab-nr17" class="tab-panel">
      <div class="grid-2">
        <div class="card">
          <h3 style="margin-top:0;">Distribui√ß√£o por risco (NR-17)</h3>
          <canvas id="chart-nr17-risco" height="220"></canvas>
          <p class="chart-caption">
            Avalia√ß√µes classificadas em Baixo, M√©dio e Alto risco por posto de trabalho.
          </p>
        </div>

        <div class="card">
          <h3 style="margin-top:0;">Scores m√©dios por setor / GHE</h3>
          <canvas id="chart-nr17-setores" height="220"></canvas>
          <p class="chart-caption">
            Score m√©dio ergon√¥mico por setor/GHE. Ideal para priorizar interven√ß√µes.
          </p>
        </div>
      </div>
    </section>

    <!-- PAINEL PCMSO / ASO -->
    <section id="tab-pcmsos" class="tab-panel">
      <div class="grid-2">
        <div class="card">
          <h3 style="margin-top:0;">Exames por m√™s</h3>
          <canvas id="chart-pcmsos-mensal" height="220"></canvas>
          <p class="chart-caption">
            Volume de ASOs (admissionais, peri√≥dicos, retorno, mudan√ßa de fun√ß√£o, demissionais) por m√™s.
          </p>
        </div>

        <div class="card">
          <h3 style="margin-top:0;">Situa√ß√£o de ASOs</h3>
          <canvas id="chart-pcmsos-status" height="220"></canvas>
          <p class="chart-caption">
            Quantidade de ASOs v√°lidos, vencidos e a vencer em 30 dias.
          </p>
        </div>
      </div>
    </section>

    <!-- PAINEL PGR / NR-01 -->
    <section id="tab-pgr" class="tab-panel">
      <div class="grid-2">
        <div class="card">
          <h3 style="margin-top:0;">Perigos por categoria</h3>
          <canvas id="chart-pgr-categorias" height="220"></canvas>
          <p class="chart-caption">
            Distribui√ß√£o dos perigos (f√≠sicos, qu√≠micos, biol√≥gicos, ergon√¥micos, mec√¢nicos, etc.).
          </p>
        </div>

        <div class="card">
          <h3 style="margin-top:0;">Status das a√ß√µes do PGR</h3>
          <canvas id="chart-pgr-acoes" height="220"></canvas>
          <p class="chart-caption">
            A√ß√µes planejadas, em andamento e conclu√≠das conforme o cronograma do PGR.
          </p>
        </div>
      </div>
    </section>

    <!-- PAINEL LTCAT -->
    <section id="tab-ltcat" class="tab-panel">
      <div class="grid-2">
        <div class="card">
          <h3 style="margin-top:0;">Agentes por setor</h3>
          <canvas id="chart-ltcat-setor" height="220"></canvas>
          <p class="chart-caption">
            Quantidade de agentes nocivos identificados por setor / ambiente.
          </p>
        </div>

        <div class="card">
          <h3 style="margin-top:0;">Enquadramento por c√≥digo</h3>
          <canvas id="chart-ltcat-enquadramento" height="220"></canvas>
          <p class="chart-caption">
            Quantidade de enquadramentos por c√≥digo de aposentadoria especial.
          </p>
        </div>
      </div>
    </section>
  </main>

  <script>
    // logout simples (mesmo padr√£o dos outros m√≥dulos)
    function logout() {
      localStorage.removeItem("authToken");
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
